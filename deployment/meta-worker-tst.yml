# security container and core container for Aloe development
# environment tag 0.0.1-T2dev to distinguish from regular metaV3 security contatiner.
#
meta-worker:
  image: tapis/metawrkr:0.0.4-T2dev
  restart: "always"
  log_driver: json-file
  log_opt:
    max-size: 100m
    max-file: "5"
  command: "java ${JAVA_OPTS} -cp metawrkr.jar:lib/* edu/utexas/tacc/tapis/meta/LRQWorker"
  container_name: meta-tapis-wrkr-tst
  environment:
    - 'tapis.meta.mongo.lrq.uri=mongodb://tapisadmin:d3f%40ult@aloe-dev04.tacc.utexas.edu:27019/?authSource=admin&authMechanism=SCRAM-SHA-1'
    - 'tapis.log.directory=/metawrkr/logs'
    - 'tapis.log.file=meta-worker.log'
    - 'tapis.meta.query.host=aloe-dev04.tacc.utexas.edu'
    - 'tapis.meta.query.port=27019'
    - 'tapis.meta.query.user=tapisadmin'
    - 'tapis.meta.query.password=d3f@ult'
    - 'tapis.meta.query.authDB=admin'
    - 'tapis.meta.queue.host=aloe-dev04.tacc.utexas.edu'
    - 'tapis.meta.queue.port=5672'
    - 'tapis.meta.queue.user=guest'
    - 'tapis.meta.queue.password=guest'
    - 'JAVA_OPTS=-Xms1g -Xmx2g -Dlogback.configurationFile=/metawrkr/logback.xml'
    - 'tapis.meta.queue.name=lrq-vdjserver.org'
    - 'tapis.meta.tenant=vdjserver.org'
    - 'tapis.meta.data.dir=lrqdata'

  volumes:
    - '/Users/sterry1/var/log/splunk/meta-worker:/metawrkr/logs'
    - './etc/logback.xml:/metawrkr/logback.xml'
    - './lrqdata:/metawrkr/lrqdata'
